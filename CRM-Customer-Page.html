<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ - CRM</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f0f8ff;
        }

        .bg-main {
            background-color: #e3f2fd;
        }

        .text-accent {
            color: #0288d1;
        }

        .btn-main {
            background-color: #81d4fa;
            color: white;
            font-weight: 500;
        }

        .btn-main:hover {
            background-color: #4fc3f7;
        }

        .btn-green {
            background-color: #a5d6a7;
        }

        .btn-green:hover {
            background-color: #81c784;
        }

        .rounded-xl {
            border-radius: 1rem;
        }

        .shadow-soft {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .loading-text {
            color: #0288d1;
            font-weight: 500;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.3;
            }
        }

        /* ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
        .bg-orange-300 {
            background-color: #FFB74D;
            /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• */
        }

        .bg-orange-100 {
            background-color: #FFE0B2;
            /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ö‡∏≤ */
        }
    </style>
    <style>
        .modal-header {
            background-color: #e1f5fe;
            /* ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
            color: #0277bd;
        }

        .hover\:bg-blue-50:hover {
            background-color: #e3f2fd;
        }

        .rounded-xl {
            border-radius: 1rem;
        }

        .shadow-lg {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
        }
    </style>

</head>

<body class="bg-gray-100 min-h-screen">
    <div class="flex">
        <aside class="w-64 bg-blue-100 text-blue-900 min-h-screen shadow-md">
            <div class="px-6 py-4 text-xl font-bold border-b border-blue-200">üíº CRM System</div>
            <div class="px-6 text-sm mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
            <nav>
                <ul>
                    <li><a href="CRM-Dashboard-Layout.html" class="block px-6 py-3 hover:bg-blue-200">üìä Dashboard</a></li>
                    <li class="block px-6 py-3 bg-blue-200 rounded-l-full">üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</li>
                    <li><a href="CRM-Appointment-Page.html" class="block px-6 py-3 hover:bg-blue-200">üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</a></li>
                    <li><a href="#" class="block px-6 py-3 hover:bg-blue-200">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a></li>
                </ul>
            </nav>
        </aside>

        <main class="flex-1 p-6">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold text-accent">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h1>
                <button onclick="document.getElementById('addCustomerModal').classList.remove('hidden')"
                    class="btn-green px-4 py-2 rounded-xl shadow-soft">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-soft">
                <h2 class="text-lg font-semibold mb-4">üë§ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div class="flex mb-4 space-x-4">
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..."
                        class="flex-1 px-4 py-2 border rounded w-1/2">
                </div>
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-blue-50 text-left">
                            <th class="py-2 px-3">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</th>
                            <th class="px-3">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</th>
                            <th class="px-3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                            <th class="px-3">‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</th>
                            <th class="px-3">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="customerTable">
                        <tr id="loadingRow">
                            <td colspan="5" class="text-center py-4 loading-text">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-soft w-full max-w-xl">
            <div class="bg-blue-100 text-blue-800 px-4 py-3 rounded-t-xl flex justify-between items-center">
                <h2 class="text-lg font-bold">üîç ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
                <button onclick="document.getElementById('detailModal').classList.add('hidden')">‚úï</button>
            </div>
            <div id="detailContent" class="p-6 grid grid-cols-2 gap-x-4 gap-y-2 text-sm"></div>
        </div>
    </div>

    <div id="addCustomerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-soft w-full max-w-xl">
            <div class="bg-green-100 text-green-800 px-4 py-3 rounded-t-xl flex justify-between items-center">
                <h2 id="modalTitle" class="text-lg font-bold">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
                <button onclick="document.getElementById('addCustomerModal').classList.add('hidden')">‚úï</button>
            </div>
            <form id="addCustomerForm" class="p-6 grid grid-cols-2 gap-4 text-sm">
                <input type="text" name="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏ó‡∏¢)" class="border px-2 py-1 rounded">
                <input type="text" name="englishName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)" class="border px-2 py-1 rounded"> <input type="text" name="companyName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" class="border px-2 py-1 rounded">
                <input type="text" name="telephone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="border px-2 py-1 rounded">
                <input type="email" name="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" class="border px-2 py-1 rounded">
                <input type="url" name="companyWebpage" placeholder="‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" class="border px-2 py-1 rounded col-span-2">
                <input type="text" name="group" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°" class="border px-2 py-1 rounded">
                <input type="text" name="type" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô" class="border px-2 py-1 rounded">
                <input type="text" name="investmentType" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô" class="border px-2 py-1 rounded">
                <input type="text" name="channel" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á" class="border px-2 py-1 rounded">
                <input type="text" name="contactPerson" placeholder="‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" class="border px-2 py-1 rounded">
                <input type="text" name="detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" class="border px-2 py-1 rounded">
                <input type="text" name="result" placeholder="‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" class="border px-2 py-1 rounded">
                <input type="text" name="followUp" placeholder="‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πà‡∏≠" class="border px-2 py-1 rounded">
                <textarea name="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" class="border px-2 py-1 rounded col-span-2"></textarea>

                <button id="addCustomerBtn" type="submit"
                    class="btn-green text-white px-4 py-2 rounded col-span-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </form>
        </div>
    </div>

    <div id="updateCustomerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-orange-100 rounded-xl shadow-soft w-full max-w-xl">
            <div class="bg-orange-300 text-orange-800 px-4 py-3 rounded-t-xl flex justify-between items-center">
                <h2 id="modalTitle" class="text-lg font-bold">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
                <button onclick="document.getElementById('updateCustomerModal').classList.add('hidden')">‚úï</button>
            </div>
            <form id="updateCustomerForm" class="p-6 grid grid-cols-2 gap-4 text-sm">
                <input type="hidden" name="customerId" id="updateCustomerId">
                <input type="text" name="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏ó‡∏¢)" class="border px-2 py-1 rounded">
                <input type="text" name="englishName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)" class="border px-2 py-1 rounded"> <input type="text" name="companyName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" class="border px-2 py-1 rounded">
                <input type="text" name="telephone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="border px-2 py-1 rounded">
                <input type="email" name="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" class="border px-2 py-1 rounded">
                <input type="url" name="companyWebpage" placeholder="‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" class="border px-2 py-1 rounded col-span-2">
                <input type="text" name="group" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°" class="border px-2 py-1 rounded">
                <input type="text" name="type" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô" class="border px-2 py-1 rounded">
                <input type="text" name="investmentType" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô" class="border px-2 py-1 rounded">
                <input type="text" name="channel" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á" class="border px-2 py-1 rounded">
                <input type="text" name="contactPerson" placeholder="‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" class="border px-2 py-1 rounded">
                <input type="text" name="detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" class="border px-2 py-1 rounded">
                <input type="text" name="result" placeholder="‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" class="border px-2 py-1 rounded">
                <input type="text" name="followUp" placeholder="‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πà‡∏≠" class="border px-2 py-1 rounded">
                <textarea name="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" class="border px-2 py-1 rounded col-span-2"></textarea>

                <button id="updateCustomerBtn" type="submit"
                    class="btn-green text-white px-4 py-2 rounded col-span-2 bg-orange-300 hover:bg-orange-400">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </form>
        </div>
    </div>


    <script>
        const SHEET_API = "https://script.google.com/macros/s/AKfycbwKgcJ5bwGXyqQ6mEBdd6w9f8DrAbZG_6tFRDAiTq402eERxml0ULfCl9umlqttsLoHvA/exec";

        //‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        async function loadData() {
            const table = document.getElementById("customerTable");
            table.innerHTML = `<tr><td colspan="5" class="text-center py-4 loading-text">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>`;

            try {
                const res = await fetch(SHEET_API + "?action=customers");
                const data = await res.json();
                table.innerHTML = "";
                window.customerData = data;

                // ‚úÖ ‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
                console.log("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:", window.customerData);

                data.forEach((item, index) => {
                    // Note: The column indices here must match your Google Sheet exactly.
                    // Assuming new order: [id, name, englishName, companyName, telephone, email, companyWebpage, group, type, investmentType, channel, contactPerson, detail, result, followUp, note]
                    const customerName = item[1] || "";
                    const englishName = item[2] || ""; // New: English Name
                    const companyName = item[3] || ""; // Shifted: Company Name
                    const displayCustomer = companyName ? `${customerName} (${companyName})` : customerName;

                    const channel = item[10] || ""; // Shifted: Channel
                    const detail = item[12] || ""; // Shifted: Detail
                    const result = item[13] || ""; // Shifted: Result

                    const tr = document.createElement("tr");
                    tr.className = "border-t hover:bg-blue-50 transition";
                    tr.innerHTML = `
                        <td class="py-2 px-3">üë§ ${displayCustomer}</td>
                        <td class="px-3">üì± ${channel}</td>
                        <td class="px-3">${detail}</td>
                        <td class="px-3">${result}</td>
                        <td class="px-3 text-blue-600 underline cursor-pointer" onclick="showDetail(${index})">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</td>
                    `;
                    table.appendChild(tr);
                });
            } catch (err) {
                console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
            }
        }


        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
        function showDetail(index) {
            const customer = window.customerData[index]; // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å customerData
            console.log("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:", customer); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

            if (!customer) {
                console.error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô index:", index);
                return;
            }

            // Updated indices based on the new customer data structure:
            // [id, name, englishName, companyName, telephone, email, companyWebpage, group, type, investmentType, channel, contactPerson, detail, result, followUp, note]
            const detail = `
                <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏ó‡∏¢):</strong> ${customer[1] || ''}</div>
                <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©):</strong> ${customer[2] || ''}</div> <div><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</strong> ${customer[3] || ''}</div>
                <div><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> ${customer[4] || ''}</div>
                <div><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> ${customer[5] || ''}</div>
                <div class="col-span-2"><strong>‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</strong> <a href="${customer[6]}" target="_blank" class="text-blue-600 hover:underline">${customer[6] || ''}</a></div>
                <div><strong>‡∏Å‡∏•‡∏∏‡πà‡∏°:</strong> ${customer[7] || ''}</div>
                <div><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô:</strong> ${customer[8] || ''}</div>
                <div><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô:</strong> ${customer[9] || ''}</div>
                <div><strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á:</strong> ${customer[10] || ''}</div>
                <div><strong>‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> ${customer[11] || ''}</div>
                <div><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${customer[12] || ''}</div>
                <div><strong>‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> ${customer[13] || ''}</div>
                <div><strong>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πà‡∏≠:</strong> ${customer[14] || ''}</div>
                <div class="col-span-2"><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${customer[15] || ''}</div>
                <div class="mt-4 flex gap-4">
                    <button onclick="openUpdateCustomerModal(${index})" class="bg-yellow-500 text-white px-4 py-2 rounded-xl">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button onclick="deleteCustomer(${index})" class="bg-red-500 text-white px-4 py-2 rounded-xl">‡∏•‡∏ö</button>
                </div>
            `;
            document.getElementById("detailContent").innerHTML = detail;
            document.getElementById("detailModal").classList.remove("hidden");
        }


        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
        async function addCustomer(data) {
            const params = {
                method: 'POST',
                body: new URLSearchParams({
                    action: 'addCustomer',
                    name: data.name,
                    englishName: data.englishName, // ‚úÖ Added
                    companyName: data.companyName,
                    telephone: data.telephone,
                    email: data.email,
                    companyWebpage: data.companyWebpage,
                    group: data.group,
                    type: data.type,
                    investmentType: data.investmentType,
                    channel: data.channel,
                    contactPerson: data.contactPerson,
                    detail: data.detail,
                    result: data.result,
                    followUp: data.followUp,
                    note: data.note
                })
            };

            try {
                const response = await fetch(SHEET_API, params);
                if (!response.ok) throw new Error('Network response was not ok');
                const msg = await response.text();
                alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + msg);
                document.getElementById("addCustomerModal").classList.add('hidden');
                loadData();
                document.getElementById('addCustomerForm').reset();
            } catch (error) {
                console.error("Error:", error);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
            }
        }

        document.getElementById('addCustomerForm').addEventListener('submit', function (event) {
            event.preventDefault(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const name = document.querySelector('#addCustomerForm input[name="name"]').value;
            if (!name) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
                return;
            }

            const data = {
                name: name,
                englishName: document.querySelector('#addCustomerForm input[name="englishName"]').value, // ‚úÖ Added
                companyName: document.querySelector('#addCustomerForm input[name="companyName"]').value,
                telephone: document.querySelector('#addCustomerForm input[name="telephone"]').value,
                email: document.querySelector('#addCustomerForm input[name="email"]').value,
                companyWebpage: document.querySelector('#addCustomerForm input[name="companyWebpage"]').value,
                group: document.querySelector('#addCustomerForm input[name="group"]').value,
                type: document.querySelector('#addCustomerForm input[name="type"]').value,
                investmentType: document.querySelector('#addCustomerForm input[name="investmentType"]').value,
                channel: document.querySelector('#addCustomerForm input[name="channel"]').value,
                contactPerson: document.querySelector('#addCustomerForm input[name="contactPerson"]').value,
                detail: document.querySelector('#addCustomerForm input[name="detail"]').value,
                result: document.querySelector('#addCustomerForm input[name="result"]').value,
                followUp: document.querySelector('#addCustomerForm input[name="followUp"]').value,
                note: document.querySelector('#addCustomerForm textarea[name="note"]').value
            };

            addCustomer(data); // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô addCustomer
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
        async function deleteCustomer(index) {
            const customer = window.customerData[index];
            const customerId = customer[0];

            if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?")) {
                try {
                    const params = {
                        method: 'POST',
                        body: new URLSearchParams({
                            action: 'deleteCustomer',
                            customerId: customerId
                        })
                    };
                    const response = await fetch(SHEET_API, params);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const msg = await response.text();
                    alert("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    loadData();
                    document.getElementById("detailModal").classList.add('hidden');
                } catch (error) {
                    console.error("Error:", error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
                }
            }
        }

        // Function to open the update modal and populate fields
        function openUpdateCustomerModal(index) {
            const customer = window.customerData[index];
            if (!customer) {
                console.error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô index:", index);
                return;
            }

            const updateForm = document.getElementById('updateCustomerForm');
            updateForm.querySelector('input[name="customerId"]').value = customer[0]; // Assuming customer[0] is the ID
            updateForm.querySelector('input[name="name"]').value = customer[1];
            updateForm.querySelector('input[name="englishName"]').value = customer[2]; // ‚úÖ Added
            updateForm.querySelector('input[name="companyName"]').value = customer[3]; // Shifted index
            updateForm.querySelector('input[name="telephone"]').value = customer[4];   // Shifted index
            updateForm.querySelector('input[name="email"]').value = customer[5];      // Shifted index
            updateForm.querySelector('input[name="companyWebpage"]').value = customer[6]; // Shifted index
            updateForm.querySelector('input[name="group"]').value = customer[7];      // Shifted index
            updateForm.querySelector('input[name="type"]').value = customer[8];      // Shifted index
            updateForm.querySelector('input[name="investmentType"]').value = customer[9]; // Shifted index
            updateForm.querySelector('input[name="channel"]').value = customer[10];     // Shifted index
            updateForm.querySelector('input[name="contactPerson"]').value = customer[11]; // Shifted index
            updateForm.querySelector('input[name="detail"]').value = customer[12];     // Shifted index
            updateForm.querySelector('input[name="result"]').value = customer[13];     // Shifted index
            updateForm.querySelector('input[name="followUp"]').value = customer[14];    // Shifted index
            updateForm.querySelector('textarea[name="note"]').value = customer[15];     // Shifted index

            document.getElementById('detailModal').classList.add('hidden');
            document.getElementById('updateCustomerModal').classList.remove('hidden');
        }

        // Function to handle updating a customer
        async function updateCustomer(data) {
            const params = {
                method: 'POST',
                body: new URLSearchParams({
                    action: 'updateCustomer',
                    customerId: data.customerId,
                    name: data.name,
                    englishName: data.englishName, // ‚úÖ Added
                    companyName: data.companyName,
                    telephone: data.telephone,
                    email: data.email,
                    companyWebpage: data.companyWebpage,
                    group: data.group,
                    type: data.type,
                    investmentType: data.investmentType,
                    channel: data.channel,
                    contactPerson: data.contactPerson,
                    detail: data.detail,
                    result: data.result,
                    followUp: data.followUp,
                    note: data.note
                })
            };

            try {
                const response = await fetch(SHEET_API, params);
                if (!response.ok) throw new Error('Network response was not ok');
                const msg = await response.text();
                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + msg);
                document.getElementById("updateCustomerModal").classList.add('hidden');
                loadData();
            } catch (error) {
                console.error("Error:", error);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
            }
        }

        document.getElementById('updateCustomerForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Stop default form submission

            const customerId = document.querySelector('#updateCustomerForm input[name="customerId"]').value;
            const name = document.querySelector('#updateCustomerForm input[name="name"]').value;

            if (!name || !customerId) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ID ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
                return;
            }

            const data = {
                customerId: customerId,
                name: name,
                englishName: document.querySelector('#updateCustomerForm input[name="englishName"]').value, // ‚úÖ Added
                companyName: document.querySelector('#updateCustomerForm input[name="companyName"]').value,
                telephone: document.querySelector('#updateCustomerForm input[name="telephone"]').value,
                email: document.querySelector('#updateCustomerForm input[name="email"]').value,
                companyWebpage: document.querySelector('#updateCustomerForm input[name="companyWebpage"]').value,
                group: document.querySelector('#updateCustomerForm input[name="group"]').value,
                type: document.querySelector('#updateCustomerForm input[name="type"]').value,
                investmentType: document.querySelector('#updateCustomerForm input[name="investmentType"]').value,
                channel: document.querySelector('#updateCustomerForm input[name="channel"]').value,
                contactPerson: document.querySelector('#updateCustomerForm input[name="contactPerson"]').value,
                detail: document.querySelector('#updateCustomerForm input[name="detail"]').value,
                result: document.querySelector('#updateCustomerForm input[name="result"]').value,
                followUp: document.querySelector('#updateCustomerForm input[name="followUp"]').value,
                note: document.querySelector('#updateCustomerForm textarea[name="note"]').value
            };

            updateCustomer(data);
        });

        document.addEventListener("DOMContentLoaded", loadData);
    </script>
</body>

</html>